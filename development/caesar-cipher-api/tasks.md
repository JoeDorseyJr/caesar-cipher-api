# Tasks – Caesar Cipher API

## Phase 1 – Scaffolding & Infrastructure (Design §Implementation Phases → Phase 1)
- [ ] **Set up Bun project with strict TypeScript config** (Est: 2h) — Req: TR-001, TR-003; Design Refs: §System Architecture Overview, §Routing & Request Lifecycle. Validation: run `bun install && bun test` to confirm compiler strictness passes and start server with `bun run dev` (default port 3000) plus `PORT=4000 bun run dev` to verify override works for new contributors.
- [ ] **Establish project structure and config module** (Est: 3h) — Req: FR-002, TR-007; Design Refs: §Configuration & Environment Management. Validation: from a clean checkout, `bun run dev` logs typed config values, missing env vars raise descriptive errors, and `.env.example` plus README list each required variable and default.
- [ ] **Provision local Postgres tooling and environment templates** (Est: 3h) — Req: TR-005, TR-006; Design Refs: §Authentication & Postgres Integration. Validation: `docker compose up db` starts Postgres and `.env.example` instructions guide a teammate to connect without edits.
- [ ] **Implement health route and structured logging skeleton** (Est: 2h) — Req: CC-HEALTH-001, FR-004; Design Refs: §Logging & Observability. Validation: `curl http://localhost:3000/health` returns `{ "status": "ok" }` within 50 ms and server logs structured output for the request.
- [ ] **Configure build script and validate dist artifacts** (Est: 3h) — Req: FR-005, FR-007, TR-002, OBJ-4; Design Refs: §Build & Deployment Preparation. Validation: `bun run build` generates `dist/server.js`, README documents how to launch it (`bun run dist/server.js`), and teammate starts the built server successfully.

## Phase 2 – Core Cipher Functions & Endpoints (Design §Implementation Phases → Phase 2)
- [ ] **Develop core cipher utilities with tests** (Est: 5h) — Req: FR-001, TR-004, CC-ENC-003, CC-DEC-002; Design Refs: §Cipher Logic Module. Validation: `bun test` suite covers shifts 0–25, uppercase/lowercase, punctuation, ensuring encrypted/decrypted text matches expectations for end users.
- [ ] **Create `/encrypt` and `/decrypt` routes with validation** (Est: 4h) — Req: CC-ENC-001, CC-ENC-002, CC-DEC-001, CC-DEC-003, FR-003; Design Refs: §Routing & Request Lifecycle. Validation: integration tests plus `curl` requests (valid & invalid) demonstrate 200 responses for correct input and 400 for malformed payloads.
- [ ] **Add `/encode` default shift and `/rot13` helper** (Est: 3h) — Req: CC-ENCDEF-001, CC-ENCDEF-002, CC-ROT13-001, CC-ROT13-002; Design Refs: §Cipher Logic Module. Validation: manual `curl` shows default shift=3 and constant rot13 output, while tests assert payload keys.
- [ ] **Document quick-start usage and environment variables in README** (Est: 2h) — Req: Objectives, TR-007, FR-007; Design Refs: §API Documentation Strategy, §Configuration & Environment Management. Validation: teammate follows README (including env var setup) to encrypt text via `curl` and launch the built bundle without additional guidance.

## Phase 3 – Advanced Cipher Features (Design §Implementation Phases → Phase 3)
- [ ] **Implement `/bruteforce` endpoint with utilities** (Est: 4h) — Req: CC-BRUTE-001, CC-BRUTE-002, CC-BRUTE-003, FR-002; Design Refs: §Cipher Logic Module. Validation: integration test verifies keys `"0"`–`"25"`, and manual `curl` confirms original text at shift 0 for analysts.
- [ ] **Build `autoDecrypt` heuristic and endpoint** (Est: 5h) — Req: CC-AUTO-001, CC-AUTO-002, CC-AUTO-003; Design Refs: §Cipher Logic Module. Validation: unit tests with known ciphertext confirm chosen shift, integration tests confirm `candidates` array behavior for ambiguous input.
- [ ] **Enhance `/info` metadata route** (Est: 2h) — Req: CC-INFO-001, CC-INFO-002; Design Refs: §API Documentation Strategy. Validation: tests confirm version sourced from `package.json` and manual `curl /info` allows developers to list available routes.
- [ ] **Implement performance benchmark suite** (Est: 4h) — Req: CC-HEALTH-002, NFR-001, NFR-002; Design Refs: §Testing Strategy. Validation: automated script sends 1 kB payloads at concurrency ≥50 for cipher endpoints, records average/95th-percentile latency <100 ms, and logs `/health` response times <50 ms with results committed to CI artifacts.

## Phase 4 – Authentication & Database Layer (Design §Implementation Phases → Phase 4, §Request Flow with Authentication)
- [ ] **Create migrations and models for `api_keys`** (Est: 4h) — Req: CC-AUTH-002, TR-006; Design Refs: §Authentication & Postgres Integration. Validation: run `bun run migrate` on fresh database and confirm table structure via `psql` query accessible to teammates.
- [ ] **Implement Postgres connector and credential repository** (Est: 3h) — Req: TR-005, TR-006; Design Refs: §Authentication & Postgres Integration. Validation: integration test mocks DB failure to ensure errors bubble with helpful messages for operators.
- [ ] **Develop bearer auth middleware** (Est: 4h) — Req: CC-AUTH-001, FR-006, NFR-004; Design Refs: §Request Flow with Authentication. Validation: tests plus manual `curl` without token return 401 JSON error, with seed token return 200 ensuring authorized users succeed quickly.
- [ ] **Implement `seed:local` script and docs** (Est: 2h) — Req: CC-AUTH-003, FR-005; Design Refs: §Authentication & Postgres Integration. Validation: teammate runs `bun run seed:local`, retrieves generated token, and successfully hits `/encrypt` following README instructions.
- [ ] **Measure authenticated request overhead** (Est: 3h) — Req: NFR-004; Design Refs: §Testing Strategy, §Request Flow with Authentication. Validation: extend benchmark suite to compare authed vs unauthenticated latency, documenting results ≤10 ms overhead in CI artifacts.

## Phase 5 – Hardening, Docs & Tooling (Design §Implementation Phases → Phase 5)
- [ ] **Add structured error handler with `{ code, message }`** (Est: 3h) — Req: NFR-003, FR-003; Design Refs: §Routing & Request Lifecycle, §Logging & Observability. Validation: failing validation returns standardized JSON verified via tests and manual `curl`.
- [ ] **Generate OpenAPI spec and doc tooling** (Est: 4h) — Req: Objectives, CC-INFO-001, TR-007; Design Refs: §API Documentation Strategy. Validation: run `bun run doc:check` and import spec into Postman so developers can execute sample encrypt call.
- [ ] **Establish CI scripts for tests, migrations, linting, build, benchmarks** (Est: 4h) — Req: FR-005, FR-007, TR-002, TR-004, TR-006; Design Refs: §Build & Deployment Preparation, §Testing Strategy. Validation: CI pipeline (or local runner) executes `bun test`, `bun run migrate`, `bun run lint`, `bun run build`, and benchmark script without manual intervention.
- [ ] **Finalize manual validation playbook** (Est: 2h) — Req: Objectives, NFR-001, FR-007; Design Refs: §Testing Strategy. Validation: checklist includes `curl` commands, benchmark triggers, and `bun build` verification; peer runs through to confirm end-user workflow clarity.

## Ongoing Quality Gates
- [ ] **Maintain ≥90% coverage on cipher utilities** (Est: ongoing 1h per review) — Req: TR-004; Design Refs: §Testing Strategy. Validation: coverage reports attached to PRs demonstrating threshold met, showing end users can trust logic.
- [ ] **Monitor performance budgets after each feature** (Est: ongoing 1h per sprint) — Req: NFR-001, NFR-002, NFR-004; Design Refs: §Testing Strategy, §Logging & Observability. Validation: rerun benchmark suite post-feature and capture metrics ensuring latency, concurrency, and auth overhead guarantees continue to hold.
